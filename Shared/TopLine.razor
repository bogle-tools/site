@inject NavigationManager Navigation
@using System.Text.Json.Serialization
@inject IJSRuntime JSRuntime
@inject IAppData appData
@inject LocalStorageAccessor LocalStorageAccessor
@inject IRSData irsData
@inject IJSRuntime JS

<div style=float:right>
    <a style=margin-left:0px href=/about>Private data</a>: <button @onclick=@Save>Save</button> or 
    <button @onclick=@Clear>Erase</button>
</div>
@code{
    private async Task Save() {
        await ProfileUtilities.Save(appData.CurrentProfileName, appData.FamilyData);
    }

    private async Task Clear() {
        ProfileUtilities.Clear(appData, appData.CurrentProfileName, irsData);
        Navigation.NavigateTo("/");
    }

    protected override async Task OnInitializedAsync()
    {
        ProfileUtilities.LocalStorageAccessor = LocalStorageAccessor;
        await ProfileUtilities.SetProfileNames(appData);

        if (appData.CurrentProfileName != null && appData.ProfileNames.Contains(appData.CurrentProfileName))
        {
            await ProfileUtilities.Load(appData);
        }
        else
        {
            appData.CurrentProfileName = null;
            await ProfileUtilities.SetProfileNames(appData);
            appData.LastPageUri = Navigation.Uri;
            Navigation.NavigateTo("/profiles");
        }
    }
}
