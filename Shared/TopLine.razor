@inject NavigationManager Navigation
@using System.Text.Json.Serialization
@inject IJSRuntime JSRuntime
@inject IAppData appData
@inject LocalStorageAccessor LocalStorageAccessor
@inject IRSData irsData
@inject IJSRuntime JS

<div style=width:100%;vertical-align:middle>
    <div style=float:left;padding:3px>
        <a href=/profiles @onclick:preventDefault @onclick=navWithBackStack>Switch Profile</a>
    </div
    <div style=float:right>
        <a style=margin-left:0px href=/about>Private data</a>: <button @onclick=@Save>Save</button> or 
        <button @onclick=@Clear>Erase</button>
    </div>
</div>
@code{

    private void navWithBackStack()
    {
        appData.LastPageUri = Navigation.Uri;
        Navigation.NavigateTo("/profiles");
    }
    private async Task Save() {
        await ProfileUtilities.Save(appData.CurrentProfileKey, appData.FamilyData);
    }    

    private async Task Clear() {
        ProfileUtilities.Clear(appData, irsData);
        Navigation.NavigateTo("/");
    }

    protected override async Task OnInitializedAsync()
    {
        ProfileUtilities.LocalStorageAccessor = LocalStorageAccessor;
        appData.CurrentProfileName = "primary";
        await ProfileUtilities.Load(appData);

        var keys = new List<string>();
        var keysJsonElement = await LocalStorageAccessor.GetKeys();
        foreach (var el in keysJsonElement.EnumerateArray())
        {
            string? value = el.GetString();
            if (value != null) {
                switch (value) {
                    case "i18nextLng":
                        break;
                    case "localSave":
                        keys.Add("primary");
                        break;
                    default:
                        keys.Add(value);
                        break;
                }
            }
        }

        appData.ProfileNames = keys;
    }
}
